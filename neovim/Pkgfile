# Description : Vim-fork focused on extensibility and usability
# URL         : https://github.com/neovim/neovim
# Maintainer  : camille, camille at lzr dot pw
# Depends on  : luajit libuv libluv msgpack lua-lpeg lua-mpack libvterm libtermkey utf8proc

name=neovim
version=git
release=1
source=()

download() {
    if [[ -d $PKGMK_SOURCE_DIR/$name ]]; then
        git -C "$PKGMK_SOURCE_DIR/$name" fetch --depth 1
        git -C "$PKGMK_SOURCE_DIR/$name" clean -f
        git -C "$PKGMK_SOURCE_DIR/$name" reset --hard "origin/$2"
    else
        git -C "$PKGMK_SOURCE_DIR" clone --depth 1 "$1" -b "$2" "$name"
    fi

    cp -r "$PKGMK_SOURCE_DIR/$name" "$PKGMK_WORK_DIR/src/$name"
}

build() {
    download "https://github.com/$name/$name" master

    cd "$name"

    mkdir build
    cd    build

    cmake ..                          \
        -DCMAKE_BUILD_TYPE=MinSizeRel \
        -DCMAKE_INSTALL_PREFIX=/usr   \
        -DENABLE_JEMALLOC=FALSE

    make DESTDIR="$PKG" install

    ln -sf /usr/bin/nvim "$PKG/usr/bin/vim"

    rm -rf "$PKG/usr/share/locale"
}
