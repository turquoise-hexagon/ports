# Description : A free and open-source widget toolkit for creating GUIs as well as cross-platform applications
# URL         : https://www.qt.io
# Maintainer  : camille, camille at lzr dot pw
# Depends on  : dbus gdk-pixbuf gst-plugins-base libepoxy libmng libxkbcommon xorg-libxcomposite xorg-libxcursor xorg-libxi xorg-libxinerama xorg-xcb-util-image xorg-xcb-util-keysyms xorg-xcb-util-wm
# Optional    : icu

name=qt5
version=5.14.2
release=1
source=("https://download.qt.io/official_releases/qt/${version%.*}/$version/single/qt-everywhere-src-$version.tar.xz")

build() {
    cd "qt-everywhere-src-$version"

    ./configure                                     \
		-archdatadir /usr/lib/qt5                   \
		-bindir /usr/lib/qt5/bin                    \
		-datadir /usr/share/qt5                     \
		-docdir /usr/share/doc/qt5                  \
		-examplesdir /usr/share/doc/qt5/examples    \
		-headerdir /usr/include/qt5                 \
		-importdir /usr/lib/qt5/imports             \
		-libdir /usr/lib                            \
		-plugindir /usr/lib/qt5/plugins             \
		-sysconfdir /usr/etc/xdg                    \
		-translationdir /usr/share/qt5/translations \
        -prefix /usr                                \
        -nomake examples                            \
        -skip qtwebengine                           \
        -opensource                                 \
        -confirm-license                            \
        -openssl-linked

    make
    make INSTALL_ROOT="$PKG" install

    # fix paths
    find "$PKG/usr/lib" -type f -name '*.prl' \
        -exec sed -ie '/^QMAKE_PRL_BUILD_DIR/d' {} \;

    sed -ie "s|$PWD/qtbase|/usr/lib/qt5|g" \
        "$PKG/usr/lib/qt5/mkspecs/modules/qt_lib_bootstrap_private.pri"

    # add symlinks
    install -d "$PKG/usr/bin"

    for file in "$PKG/usr/lib/qt5/bin/"*; do
        ln -s "../lib/qt5/bin/${file##*/}" "$PKG/usr/bin/${file##*/}-qt5"
        ln -s "../lib/qt5/bin/${file##*/}" "$PKG/usr/bin/${file##*/}"
    done

    # cleanup
    rm -rf "$PKG/usr/share/doc"
}
