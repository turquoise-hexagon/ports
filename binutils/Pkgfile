# Description : A collection of binary tools (mostly ld and as)
# URL         : https://www.gnu.org/software/binutils
# Maintainer  : camille, camille at lzr dot pw
# Depends on  : zlib flex texinfo

name=binutils
version=2.34
release=1
source=("https://ftp.gnu.org/gnu/$name/$name-$version.tar.xz")

build() {
    cd "$name-$version"

    sed -i '/^SUBDIRS/s/doc//' \
        bfd/Makefile.in

    mkdir build
    cd    build

    ../configure                   \
        --prefix=/usr              \
        --enable-shared            \
        --disable-nls              \
        --enable-ld=default        \
        --enable-gold=yes          \
        --enable-plugins           \
        --enable-install-libiberty \
        --disable-werror

    make tooldir=/usr
    make tooldir=/usr DESTDIR="$PKG" install

    rm -rf "$PKG/usr/share/info"
    rm     "$PKG/usr/share/man/man1/"{dlltool,windres,windmc}.1

    sed -i "s|-L$SRC[^ ]* ||g" \
        "$PKG/usr/lib/"lib{bfd,opcodes}.la
}
